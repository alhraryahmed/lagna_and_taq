[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-06 15:34:59.020285",
  "module": "Helpdesk",
  "name": "ipget",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "HD Ticket",
  "script": "if frappe.request:\r\n    # الحصول على عنوان IPv4 للعميل\r\n    # نتحقق أولاً من X-Forwarded-For في حالة وجود بروكسي، وإلا نستخدم remote_addr\r\n    client_ip = frappe.request.headers.get('X-Forwarded-For') \r\n    \r\n    if not client_ip:\r\n        client_ip = frappe.request.remote_addr\r\n\r\n    # معالجة الحالة التي يكون فيها أكثر من IP (مفصولة بفاصلة)\r\n    if client_ip and ',' in client_ip:\r\n        client_ip = client_ip.split(',')[0].strip()\r\n        \r\n    doc.ip_device = client_ip",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-06 14:41:07.469050",
  "module": "Helpdesk",
  "name": "show ticket",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "HD Ticket",
  "script": "specs = frappe.get_all(\r\n    \"User Permission\",\r\n    {\"user\": user, \"allow\": \"Specialization\"},\r\n    pluck=\"for_value\"\r\n)\r\n\r\nif specs:\r\n    # يبنى SQL string يدوياً بدون format\r\n    condition = \"`tabHD Ticket`.tic in (\" + \",\".join([\"'\" + s + \"'\" for s in specs]) + \")\"\r\nelse:\r\n    condition = \"1=0\"\r\n",
  "script_type": "Permission Query"
 }
]